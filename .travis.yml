language: python

python:
  - "3.6"     # current default Python on Travis CI

services:
  - docker    # Require Docker to run Splash Php Toolkit

cache:
  directories:
  - docker_images

before_install:
  - docker load -i docker_images/images.tar || true

install:
  # Install PIP dependencies
  - pip install pycryptodome crypto pysimplesoap peewee
  # Install Module as PIP dependencies
  - pip install -e ./
  # Build Docker Compose
  - docker network create splashsync --attachable
  - docker-compose up -d

# command to run tests
script:
  # Run unit tests for whole package
  - pytest
  # Run Splash Unit tests from Splash Toolkit
  - docker-compose exec toolkit php vendor/bin/phpunit -c phpunit.xml.dist
  - docker-compose stop

before_cache:
  - docker save -o docker_images/images.tar $(docker images -a -q)